<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>å°æ¡‚æ™ºèƒ½ä½“</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Microsoft YaHei', sans-serif; }
        body {  /* å±…ä¸­å¯¹é½ */
            background: #f9f9fb;    /* æµ…ç°èƒŒæ™¯ */
            color: #333;    /* æ–‡å­—é¢œè‰² */
            line-height: 1.6;   /* è¡Œé«˜ */
        }
        .container {    /* ä¸»å®¹å™¨ */
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .header {   /* é¡¶éƒ¨å¯¼èˆª */
            display: flex;  /* æ°´å¹³æ’åˆ— */
            justify-content: space-between; /* ä¸¤ç«¯å¯¹é½ */
            align-items: center;    /* å‚ç›´å±…ä¸­ */
            padding: 16px 20px; /* å†…è¾¹è· */
            background: white;  /* ç™½è‰²èƒŒæ™¯ */
            border-bottom: 1px solid #e5e5e5;   /* åº•éƒ¨è¾¹æ¡† */
            box-shadow: 0 2px 12px rgba(0,0,0,0.05); /* ç»Ÿä¸€é˜´å½± */
            border-radius: 12px;    /* åœ†è§’ */
        }
        .header-left {  /* å·¦ä¾§ä¿¡æ¯ */
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .avatar {   /* å¤´åƒ */
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
        }
        .name { font-weight: bold; font-size: 1.1rem; } /* åå­—æ ·å¼ */
        .tag { font-size: 0.85rem; color: #666; }   /* æ ‡ç­¾æ ·å¼ */
        .header-right { /* å³ä¾§æŒ‰é’®ç»„ */
            display: flex;
            gap: 12px;
        }
        .btn {  /* æŒ‰é’®é€šç”¨æ ·å¼ */
            padding: 6px 12px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.2s;
        }
        .btn-primary { background: #4a6cf7; color: white; } /* ä¸»è¦æŒ‰é’®æ ·å¼ */
        .btn-outline { background: white; color: #4a6cf7; border: 1px solid #4a6cf7; }  /* æè¾¹æŒ‰é’®æ ·å¼ */

        .main { /* æ¬¢è¿åŒºæ ·å¼ */
            display: flex;
            flex-direction: column; 
            align-items: center;
            justify-content: center;
            padding: 20px;
            height: 500px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.05); /* ç»Ÿä¸€é˜´å½± */
            text-align: center;
            margin-top: 20px;
            overflow-y: auto;
        }
        .avatar-big {   /* å¤§å¤´åƒæ ·å¼ */
            width: 120px;
            height: 120px;
            border-radius: 50%;
            border: 3px solid #4a6cf7;
            object-fit: cover;
            margin-bottom: 20px;
        }
        .welcome { font-size: 1.8rem; font-weight: bold; color: #1a3d72; }  /* æ¬¢è¿è¯­æ ·å¼ */
        .subtitle { color: #666; margin: 10px 0; }  /* å‰¯æ ‡é¢˜æ ·å¼ */
        .actions {  /* å¿«æ·æŒ‰é’®ç»„ */
            display: flex;
            gap: 12px;
            margin-top: 20px;
        }
        .action-btn {   /* å¿«æ·æŒ‰é’®æ ·å¼ */
            padding: 6px 16px;
            background: #4a6cf7;
            color: white;
            border: none;
            border-radius: 20px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        .action-btn:hover { background: #3a5ce5; }  /* æŒ‰é’®æ‚¬åœæ•ˆæœ */


        .smart-input-container { /* æ™ºèƒ½è¾“å…¥å®¹å™¨ */
            display: flex;
            flex-direction: column;  /* å‚ç›´æ’åˆ— */
            gap: 12px;  /* å…ƒç´ é—´è· */
            background: white;  /* ç™½è‰²èƒŒæ™¯ */
            border-radius: 12px;    /* åœ†è§’ */
            padding: 16px;      /* å†…è¾¹è· */
            border: 1px solid #e0e0e0;  /* è¾¹æ¡† */
            box-shadow: 0 2px 12px rgba(0,0,0,0.05);    /* é˜´å½± */
            margin-top: 20px;
        }
        .input-row { /* è¾“å…¥è¡Œ */
            display: flex;
            align-items: flex-end;
            gap: 12px;
        }
        .toolbar-row { /* å·¥å…·æ è¡Œ */
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .spacer { /* å¼¹æ€§ç©ºé—´ */
            flex: 1;
        }
        .tool-tag { /* å·¥å…·æ ‡ç­¾ */
            padding: 4px 8px;
            background: #e9ecef;
            border-radius: 12px;
            font-size: 0.8rem;
            color: #495057;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
        }
        .tool-tag:hover { background: #dee2e6; }
        .main-input { /* ä¸»è¾“å…¥åŒº */
            flex: 1;
            border: none;
            outline: none;
            background: transparent;
            font-size: 1rem;
            resize: none;
            overflow: hidden;
            min-height: 24px;
            line-height: 1.4;
        }
        .right-actions { /* å³ä¾§æ“ä½œåŒº */
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .action-icon { /* æ“ä½œå›¾æ ‡ */
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: transparent;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            transition: all 0.2s;
        }
        .action-icon:hover { background: #e9ecef; }
        .send-btn-new { /* å‘é€æŒ‰é’® */
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #3a5ce5;
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            transition: all 0.2s;
        }
        .send-btn-new:hover { background: #5a32a3; }
        .hint { /* æç¤ºæ–‡å­—æ ·å¼ */
            font-size: 0.85rem;
            color: #999;
            text-align: center;
            margin-top: 8px;
        }
        .voice-toggle { /* è¯­éŸ³å¼€å…³æ ·å¼ */
            display: flex;
            align-items: center;
            gap: 6px;
            color: #666;
            font-size: 0.85rem;
            cursor: pointer;
        }
        .voice-toggle:hover { color: #4a6cf7; } /* è¯­éŸ³å¼€å…³æ‚¬åœæ•ˆæœ */

        .message {  /* æ¶ˆæ¯å®¹å™¨æ ·å¼ */
            margin: 5px 0;
        }
        .message.user { /* ç”¨æˆ·æ¶ˆæ¯å¯¹é½å³ä¾§ */
            text-align: right;
        }
        .message.ai {   /* AIæ¶ˆæ¯å¯¹é½å·¦ä¾§ */
            text-align: left;
        }

        .bubble {   /* æ°”æ³¡æ ·å¼ */
            display: inline-block;
            padding: 8px 12px;
            border-radius: 18px;
            position: relative;
            word-break: break-word;
            line-height: 1.5;
            max-width: 70%;
        }
        .user .bubble { /* ç”¨æˆ·æ°”æ³¡æ ·å¼ */
            background: #e3f2fd;
            border-bottom-right-radius: 4px; 
        }
        .ai .bubble {   /* AIæ°”æ³¡æ ·å¼ */
            background: #f1f1f1;
            border-bottom-left-radius: 4px;
        }
        .thinking { /* æ­£åœ¨æ€è€ƒæ ·å¼ */
            color: #888;
            font-style: italic;
        }
        .welcome-container {    /* æ¬¢è¿å®¹å™¨æ ·å¼ */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 60px 20px;
            min-height: 500px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.05);
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- é¡¶éƒ¨å¯¼èˆª -->
        <div class="header">
            <div class="header-left">
                <img src="/static/images/1746030054873.jpg" class="avatar">
                <div>
                    <div class="name">å°æ¡‚æ™ºèƒ½ä½“ ğŸŒ¸</div>
                    <div class="tag">æ¡‚ç”µAIå­¦å§ Â· åœ¨çº¿é™ªä¼´</div>
                </div>
            </div>
            <div class="header-right">
                <button class="btn btn-outline username-btn">{{ username }}</button> <!-- ç”¨æˆ·åå˜æˆæŒ‰é’® -->
                <button class="btn btn-outline"><i class="fas fa-history"></i> å†å²è®°å½•</button>
                <button class="btn btn-outline" onclick="window.location.href='/logout'">é€€å‡º</button>
            </div>
        </div>

        <!-- ä¸­å¤®æ¬¢è¿åŒº -->
        <div class="main">
            <div id="welcome-content">
                <img src="/static/images/1746030054873.jpg" class="avatar-big">
                <div class="welcome">ä½ å¥½å‘€ï¼æˆ‘æ˜¯å°æ¡‚ ï½ âœ¨</div>
                <div class="subtitle">æ¡‚ç”µå­¦å§ Â· AIå‘æ˜ç¤¾ç¤¾é•¿ Â· éšæ—¶ä¸ºä½ è§£ç­”æ ¡å›­é—®é¢˜å–µ ï½</div>
                <div class="actions">
                    <button class="action-btn">æ ¡å›­ç”Ÿæ´»å’¨è¯¢</button>
                    <button class="action-btn">è¯¾ç¨‹ä¿¡æ¯æŸ¥è¯¢</button>
                    <button class="action-btn">æƒ…æ„Ÿé™ªä¼´</button>
                    <button class="action-btn">è½»åº¦æ•´æ´»</button>
                </div>
            </div>
            <!-- èŠå¤©æ¶ˆæ¯åŒºï¼ˆåˆå§‹éšè—ï¼‰ -->
            <div id="messages" style="display: none; width: 100%; flex: 1; overflow-y: auto;"></div>
        </div>

        <!-- æ™ºèƒ½è¾“å…¥å®¹å™¨ -->
        <div class="smart-input-container">
            <div class="input-row">
                <textarea id="userInput" class="main-input" placeholder="å‘å°æ¡‚æé—®å–µ~" rows="1"></textarea>
            </div>
            <div class="toolbar-row">
                <button class="tool-tag">æ·±åº¦æ€è€ƒ</button>
                <button class="tool-tag">ä»£ç </button>
                <button class="tool-tag">å›¾åƒ</button>
                <button class="tool-tag">ç¿»è¯‘</button>
                <div class="spacer"></div>
                <button class="action-icon" title="è”ç½‘æœç´¢">ğŸŒ</button>
                <button class="action-icon" title="å¼•ç”¨é“¾æ¥">ğŸ”—</button>
                <button class="action-icon" title="æ–‡ä»¶ä¸Šä¼ ">ğŸ“</button>
                <button class="send-btn-new" onclick="sendMessage()">â†‘</button>
            </div>
        </div>
    </div>

    <script>
    // è·å– DOM å…ƒç´ 
    const welcomeContent = document.getElementById('welcome-content');
    const messages = document.getElementById('messages');
    const userInput = document.getElementById('userInput');

    // å‘é€æ¶ˆæ¯
    async function sendMessage() {
        const msg = userInput.value.trim();
        if (!msg) return;

        // 1. éšè—æ¬¢è¿å†…å®¹ï¼Œæ˜¾ç¤ºèŠå¤©åŒº
        welcomeContent.style.display = 'none';
        messages.style.display = 'block';

        // 2. æ˜¾ç¤ºç”¨æˆ·æ¶ˆæ¯
        appendMessage('user', msg);

        // 3. æ¸…ç©ºè¾“å…¥æ¡†
        userInput.value = '';

        // 4. æ˜¾ç¤ºâ€œAI æ­£åœ¨æ€è€ƒ...â€
        const thinkingDiv = appendMessage('ai', '<span class="thinking">å°æ¡‚æ­£åœ¨æ€è€ƒ...</span>');

        try {
            // 5. å‘é€è¯·æ±‚åˆ°åç«¯ /chat
            const res = await fetch('/chat', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ message: msg })
            });
            const data = await res.json();

            // 6. ç§»é™¤â€œæ­£åœ¨æ€è€ƒâ€æ¶ˆæ¯
            messages.removeChild(thinkingDiv);

            // 7. æ˜¾ç¤º AI å›å¤
            if (data.reply) {
                appendMessage('ai', data.reply);
            } else {
                appendMessage('ai', 'âŒ å°æ¡‚æš‚æ—¶ä¸çŸ¥é“æ€ä¹ˆå›ç­”å‘¢...');
            }
        } catch (err) {
            messages.removeChild(thinkingDiv);
            appendMessage('ai', 'âš ï¸ ç½‘ç»œå‡ºé”™äº†ï¼Œè¯·ç¨åå†è¯•ï½');
        }
    }

    // åˆ›å»ºå¹¶æ·»åŠ æ¶ˆæ¯æ°”æ³¡
    function appendMessage(role, text) {
        const msgDiv = document.createElement('div');
        msgDiv.className = `message ${role}`;
        msgDiv.innerHTML = `
            <div class="bubble">${text}</div>
        `;
        messages.appendChild(msgDiv);
        messages.scrollTop = messages.scrollHeight; // è‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨
        return msgDiv; // è¿”å›å…ƒç´ ï¼Œæ–¹ä¾¿åç»­åˆ é™¤
    }

    // å›è½¦å‘é€
    userInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault(); // é˜²æ­¢æ¢è¡Œ
            sendMessage();
        }
    });

    // è‡ªåŠ¨è°ƒæ•´è¾“å…¥æ¡†é«˜åº¦
    userInput.addEventListener('input', () => {
        userInput.style.height = 'auto';
        userInput.style.height = Math.min(userInput.scrollHeight, 120) + 'px'; // æœ€å¤§é«˜åº¦120px
    });

    // é¡µé¢åŠ è½½å®Œæˆæ—¶ï¼Œèšç„¦è¾“å…¥æ¡†
    window.onload = () => {
        userInput.focus();
    };
    </script>
</body>
</html>